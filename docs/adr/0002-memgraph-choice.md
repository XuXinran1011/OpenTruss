# ADR-0002: 选择 Memgraph 作为图数据库

## 状态

**已采纳** - 2025-01-01

## 背景

在决定采用 Graph-First 架构后，需要选择合适的图数据库。候选方案包括：

1. **Neo4j**: 最成熟的图数据库，社区活跃
2. **Memgraph**: 高性能图数据库，兼容 Neo4j 协议
3. **Amazon Neptune**: AWS 托管的图数据库服务
4. **ArangoDB**: 多模型数据库（文档+图+键值）

## 决策

选择 **Memgraph** 作为 OpenTruss 的图数据库。

## 理由

### Memgraph 的优势

1. **性能优异**:
   - 基于 C++ 实现，查询性能比 Neo4j 快 2-10 倍
   - 内存优化，适合实时查询场景
   - 支持流式图算法

2. **开源友好**:
   - 开源版本功能完整，无功能限制
   - 社区版支持生产使用
   - 清晰的许可证（Apache 2.0 + Common Clause）

3. **兼容性好**:
   - 兼容 Neo4j Bolt 协议，可以使用 `neo4j` Python 驱动
   - 支持 Cypher 查询语言
   - 迁移成本低（如果未来需要切换到 Neo4j）

4. **易部署**:
   - 支持 Docker 部署
   - 单机部署简单
   - 资源占用相对较小

5. **实时性能**:
   - 支持实时图更新
   - 适合 HITL 工作台的实时交互需求

### 与其他方案的比较

#### vs Neo4j

| 特性 | Memgraph | Neo4j |
|------|----------|-------|
| 性能 | ⭐⭐⭐⭐⭐ 更快 | ⭐⭐⭐⭐ |
| 社区生态 | ⭐⭐⭐ 较小但活跃 | ⭐⭐⭐⭐⭐ 非常成熟 |
| 学习资源 | ⭐⭐⭐ 较少 | ⭐⭐⭐⭐⭐ 丰富 |
| 开源版本 | ⭐⭐⭐⭐⭐ 功能完整 | ⭐⭐⭐ 有功能限制 |
| 协议兼容 | ⭐⭐⭐⭐⭐ 兼容 Neo4j | ⭐⭐⭐⭐⭐ |
| 内存占用 | ⭐⭐⭐⭐ 较小 | ⭐⭐⭐ 较大 |

**选择 Memgraph 的原因**: 性能优先，开源版本功能完整，兼容 Neo4j 协议降低了迁移风险。

#### vs Amazon Neptune

| 特性 | Memgraph | Amazon Neptune |
|------|----------|----------------|
| 部署方式 | 自托管 | 托管服务 |
| 成本 | ⭐⭐⭐⭐⭐ 免费 | ⭐⭐ 按使用付费 |
| 控制权 | ⭐⭐⭐⭐⭐ 完全控制 | ⭐⭐⭐ 受限于 AWS |
| 性能 | ⭐⭐⭐⭐⭐ 优异 | ⭐⭐⭐⭐ 良好 |

**选择 Memgraph 的原因**: 项目需要完全控制数据库，避免云服务锁定，降低成本。

#### vs ArangoDB

| 特性 | Memgraph | ArangoDB |
|------|----------|----------|
| 图查询性能 | ⭐⭐⭐⭐⭐ 专为图优化 | ⭐⭐⭐ 多模型平衡 |
| Cypher 支持 | ⭐⭐⭐⭐⭐ 原生支持 | ⭐⭐ 部分支持 |
| 专注度 | ⭐⭐⭐⭐⭐ 专注图数据库 | ⭐⭐⭐ 多模型数据库 |

**选择 Memgraph 的原因**: OpenTruss 只需要图数据库功能，不需要文档或键值存储，Memgraph 在图查询方面更专业。

### 劣势和风险

1. **社区生态较小**: 
   - 学习资源相对较少
   - 第三方工具和插件较少
   - **缓解措施**: Memgraph 兼容 Neo4j，可以参考 Neo4j 的资源

2. **运维经验不足**:
   - 团队可能缺乏 Memgraph 运维经验
   - **缓解措施**: Memgraph 部署简单，文档清晰，可以逐步积累经验

3. **集群功能限制**:
   - 开源版本不支持集群
   - **缓解措施**: 初期单机部署足够，未来如需集群可考虑商业版或迁移到 Neo4j

## 后果

### 正面影响

1. **性能优异**: 满足了实时交互的性能要求
2. **成本可控**: 开源版本免费，无使用限制
3. **部署简单**: Docker 部署，运维成本低
4. **迁移灵活性**: 兼容 Neo4j 协议，未来迁移成本低

### 负面影响

1. **学习曲线**: 团队需要学习 Memgraph 特性
2. **资源相对较少**: 相比 Neo4j，学习资源和社区支持较少

### 需要采取的行动

1. ✅ 安装和配置 Memgraph
2. ✅ 实现 MemgraphClient 封装
3. ✅ 设计数据模型和索引策略
4. ⏳ 建立监控和备份机制
5. ⏳ 文档化运维流程
6. ⏳ 团队培训和知识分享

## 参考

- [Memgraph vs Neo4j Performance Comparison](https://memgraph.com/blog/memgraph-vs-neo4j-performance-comparison)
- [Memgraph Documentation](https://memgraph.com/docs)
- [Neo4j Compatibility](https://memgraph.com/docs/memgraph/reference-guide/neo4j-compatibility)

